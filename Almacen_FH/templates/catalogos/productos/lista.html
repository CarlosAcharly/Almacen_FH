{% extends "layout/base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>üì¶ Productos</h3>

  <div class="d-flex gap-2">
    <a href="{% url 'papelera_productos' %}" class="btn btn-outline-secondary">
      üß∫ Papelera
    </a>

    <a href="{% url 'crear_producto' %}" class="btn btn-primary">
      ‚ûï Nuevo Producto
    </a>
  </div>
</div>

<!-- üîç BUSCADOR -->
<div class="glass-card mb-4">
  <form method="get" class="row g-3 align-items-end">

    <div class="col-md-4">
      <label class="glass-label">Buscar</label>
      <input
        type="text"
        name="q"
        class="form-control glass-input"
        placeholder="Nombre del producto"
        value="{{ q }}"
      >
    </div>

    <div class="col-md-3">
      <label class="glass-label">Categor√≠a</label>
      <select name="categoria" class="form-select glass-input">
        <option value="">Todas</option>
        {% for cat in categorias %}
          <option value="{{ cat.id }}"
            {% if categoria_id|stringformat:"s" == cat.id|stringformat:"s" %}
              selected
            {% endif %}
          >
            {{ cat.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="glass-label">Mostrar</label>
      <select name="per_page"
              class="form-select glass-input"
              onchange="this.form.submit()">
        {% for option in per_page_options %}
          <option value="{{ option }}"
            {% if per_page == option %}selected{% endif %}>
            {{ option }} productos
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2 d-grid">
      <button class="btn glass-btn glass-btn-primary">
        üîç Buscar
      </button>
    </div>

  </form>
</div>

<!-- üìã TABLA -->
<div class="glass-card">
  <table class="table table-hover align-middle mb-0">
    <thead class="table-dark">
      <tr>
        <th>Producto</th>
        <th>Categor√≠a</th>
        <th>Stock (kg)</th>
        <th class="text-center">Estado</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>

    <tbody>
      {% for producto in page_obj %}
      <tr>
        <td>{{ producto.nombre }}</td>
        <td>{{ producto.categoria }}</td>
        <td>{{ producto.stock_kg }}</td>

        <!-- ESTADO -->
        <td class="text-center">
          {% if producto.stock_kg == 0 %}
            <span class="badge bg-danger px-3 py-2">üî• AGOTADO</span>
          {% elif producto.stock_kg <= producto.stock_minimo_kg %}
            <span class="badge bg-warning text-dark px-3 py-2">‚ö†Ô∏è BAJO</span>
          {% else %}
            <span class="badge bg-success px-3 py-2">‚úî OK</span>
          {% endif %}
        </td>

        <!-- ACCIONES -->
        <td class="text-center d-flex justify-content-center gap-1">

          <!-- üìä KARDEX -->
          <a href="{% url 'kardex_producto' producto.id %}"
             class="btn btn-sm btn-info"
             title="Kardex">
            üìä
          </a>

          <!-- ‚úèÔ∏è EDITAR -->
          <a href="{% url 'editar_producto' producto.id %}"
             class="btn btn-sm btn-warning"
             title="Editar">
            ‚úèÔ∏è
          </a>

          <!-- üóë PAPELERA -->
          <a href="{% url 'eliminar_producto' producto.id %}"
             class="btn btn-sm btn-danger"
             title="Enviar a papelera"
             onclick="return confirm('¬øEnviar este producto a la papelera?')">
            üóëÔ∏è
          </a>

        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center py-4">
          No hay productos registrados
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- üìÑ PAGINADOR -->
<nav class="mt-4">
  <ul class="pagination justify-content-center">

    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.previous_page_number }}&q={{ q }}&categoria={{ categoria_id }}&per_page={{ per_page }}">
           ‚¨Ö
        </a>
      </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">
        P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ page_obj.next_page_number }}&q={{ q }}&categoria={{ categoria_id }}&per_page={{ per_page }}">
           ‚û°
        </a>
      </li>
    {% endif %}

  </ul>
</nav>

{% endblock %}
