{% extends "layout/base.html" %}

{% block content %}
<h2>Dashboard del Almac√©n</h2>

<form method="get" class="mb-4">
  <select name="periodo" class="form-select w-25" onchange="this.form.submit()">
    <option value="diario" {% if periodo == 'diario' %}selected{% endif %}>Diario</option>
    <option value="semanal" {% if periodo == 'semanal' %}selected{% endif %}>Semanal</option>
    <option value="mensual" {% if periodo == 'mensual' %}selected{% endif %}>Mensual</option>
    <option value="anual" {% if periodo == 'anual' %}selected{% endif %}>Anual</option>
  </select>
</form>

<div class="row">
  <div class="col-md-6">
    <div class="card p-3">
      <h5>Total Entradas (kg)</h5>
      <h2 class="text-success">{{ total_entradas }}</h2>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card p-3">
      <h5>Total Salidas (kg)</h5>
      <h2 class="text-danger">{{ total_salidas }}</h2>
    </div>
  </div>
</div>

<hr>

<h4>Stock Actual por Producto</h4>

<canvas id="stockChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ctx = document.getElementById('stockChart');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: [
          {% for p in productos %}
            "{{ p.nombre }}",
          {% endfor %}
        ],
        datasets: [{
            label: 'Stock (kg)',
            data: [
              {% for p in productos %}
                {{ p.stock_kg }},
              {% endfor %}
            ],
            backgroundColor: 'rgba(54, 162, 235, 0.7)'
        }]
    }
});
</script>

{% endblock %}
