{% extends "layout/base.html" %}
{% load dietas_extras %}
{% block title %}Nueva Dieta{% endblock %}

{% block content %}

<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">游냈 Crear nueva dieta</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'crear_dieta' %}" id="formCrearDieta">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label class="form-label fw-bold">Nombre de la dieta</label>
                        {{ form.nombre|add_class:"form-control" }}
                        <small class="text-muted">Ej: Dieta Gestaci칩n, Dieta Engorda</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold">Etapa del cerdo</label>
                        {{ form.etapa|add_class:"form-select" }}
                        <small class="text-muted">Selecciona la etapa para la que est치 dise침ada esta dieta</small>
                    </div>

                    <div class="alert alert-info">
                        <small>
                            <strong>丘멆잺 Importante:</strong> Al crear la dieta se generar치 autom치ticamente un producto 
                            en el cat치logo con stock inicial 0. Podr치s agregar los ingredientes despu칠s.
                        </small>
                    </div>

                    <div class="d-flex gap-2 justify-content-end">
                        <a href="{% url 'lista_dietas' %}"
                           class="btn btn-outline-secondary">
                            Cancelar
                        </a>

                        <button type="button"
                                class="btn btn-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#modalCrearDieta">
                            游 Crear dieta
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal Crear Dieta -->
<div class="modal fade" id="modalCrearDieta" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Crear nueva dieta</h5>
            </div>
            <div class="modal-body">
                <p>쮼st치s seguro de crear la dieta <strong id="nombreDietaPreview"></strong>?</p>
                <div class="alert alert-warning small">
                    Se crear치 autom치ticamente un producto en el cat치logo con nombre "Dieta [nombre]" 
                    y stock inicial 0. Despu칠s podr치s agregar los ingredientes.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('formCrearDieta').submit()">
                    S칤, crear dieta
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Script para mostrar el nombre en el modal -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const nombreInput = document.getElementById('id_nombre');
    const modal = document.getElementById('modalCrearDieta');
    
    // Actualizar preview cuando se abre el modal
    modal.addEventListener('show.bs.modal', function() {
        const nombre = nombreInput.value || '(sin nombre)';
        document.getElementById('nombreDietaPreview').textContent = nombre;
    });
});
</script>

{% endblock %}